generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Enums
enum Unit {
  PC
  KG
}

enum StockMovementType {
  IN
  OUT
}

enum StockMovementReason {
  SALE
  DAMAGE
  RETURN
  PURCHASE
}

enum TransactionType {
  SALE
  DAMAGE
  RETURN
  PURCHASE
}

enum AnnouncementType {
  STOCK
  RESOURCE
}

// Main Model
model Product{
  id Int @id @default(autoincrement())
  branchId Int
  branch Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)
  categoryId Int
  category Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  name String
  costPerUnit Float
  soldBy Unit
  sellingPrice Float
  addedBy String
  createdAt DateTime @default(now())

  // Transaction
  transactionItem TransactionItem[]
  stockMovement StockMovement[]

  // Realtime Value Report
  productReport ProductReport?

  @@index([categoryId])
  @@index([branchId])
}

model Category{
  id Int @id @default(autoincrement())
  name String @unique
  createdAt DateTime @default(now())
  product Product[]
}

model Branch{
  id Int @id @default(autoincrement())
  name String
  createdAt DateTime @default(now())
  
  product Product[]
  transaction Transaction[]
  branchReport BranchReport?
  operatingExpense OperatingExpense[]
}

// Transaction
model Transaction{
  id Int @id @default(autoincrement())
  branchId Int
  branch Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)
  type TransactionType
  totalAmount Float?
  createdAt DateTime @default(now())

  transactionItem TransactionItem[]

  @@index([branchId, createdAt])
}

model TransactionItem{
  id Int @id @default(autoincrement())
  productId Int
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  transactionId Int
  transaction Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  transactionType TransactionType
  quantity Float
  price Float
  createdAt DateTime @default(now())

  @@index([productId, createdAt])
  @@index([transactionId])
}

model StockMovement{
  id Int @id @default(autoincrement())
  productId Int
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  movementType StockMovementType
  movementReason StockMovementReason
  quantity Float
  oldValue Float
  newValue Float
  createdAt DateTime @default(now())

  @@index([productId, createdAt])
}

// Sales & Profit Report
model BranchReport{
  id Int @id @default(autoincrement())
  branchId Int @unique
  branch Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)
  profit Float @default(0)
  revenue Float @default(0)

  @@index([branchId])
}

model ProductReport{
  id Int @id @default(autoincrement())
  productId Int @unique
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  profit Float @default(0)
  revenue Float @default(0)
  stock Float @default(0)

  @@index([productId])
}

model MonthlyReport{
  id Int @id @default(autoincrement())
  date DateTime @default(now())
  profit Float @default(0)
  revenue Float @default(0)
  stock Float @default(0)
}

// Notification
model Announcement{
  id Int @id @default(autoincrement())
  type AnnouncementType
  title String
  message String
  createdAt DateTime @default(now())
}

model OperatingExpense{
  id Int @id @default(autoincrement())
  branchId Int
  branch Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)
  name String
  amount Float
  createdAt DateTime @default(now())
}

model SystemSettings{
  id Int @id @default(autoincrement())
  key String @unique
  value String
}